# üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ Google Cloud Load Balancer

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

Google Cloud Load Balancer –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!

**Static IP**: `34.128.141.177`

## üîß –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–∏—Ç—å Cloudflare DNS

### –®–∞–≥ 1: –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é CNAME –∑–∞–ø–∏—Å—å (–µ—Å–ª–∏ –µ—Å—Ç—å)

1. –ó–∞–π–¥–∏ –≤ [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. –í—ã–±–µ—Ä–∏ –¥–æ–º–µ–Ω **dolinaflo.com**
3. –ü–µ—Ä–µ–π–¥–∏ –≤ **DNS** ‚Üí **Records**
4. –ù–∞–π–¥–∏ –∑–∞–ø–∏—Å—å `order` —Å —Ç–∏–ø–æ–º CNAME
5. –£–¥–∞–ª–∏ –µ—ë (–∫–Ω–æ–ø–∫–∞ Delete)

### –®–∞–≥ 2: –î–æ–±–∞–≤—å A –∑–∞–ø–∏—Å—å —Å IP –∞–¥—Ä–µ—Å–æ–º

**–ö–†–ò–¢–ò–ß–ù–û: Proxy –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–ö–õ–Æ–ß–ï–ù (—Å–µ—Ä–æ–µ –æ–±–ª–∞–∫–æ)!**

```
Type: A
Name: order
IPv4 address: 34.128.141.177
Proxy status: DNS only (‚òÅÔ∏è –°–ï–†–û–ï –æ–±–ª–∞–∫–æ, –ù–ï –æ—Ä–∞–Ω–∂–µ–≤–æ–µ!)
TTL: Auto
```

**–ü–æ—á–µ–º—É Proxy OFF:**

- Google Cloud SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø—Ä—è–º—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- Cloudflare Proxy –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å Google SSL
- Google CDN —É–∂–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç—É

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SSL –≤ Cloudflare

–í **SSL/TLS** ‚Üí **Overview**:

- –í—ã–±–µ—Ä–∏ **Full (strict)** –∏–ª–∏ **Off/Flexible**
- –ü–æ—Å–∫–æ–ª—å–∫—É Google —É–ø—Ä–∞–≤–ª—è–µ—Ç SSL, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å **Flexible**

## ‚è±Ô∏è –ü–æ–¥–æ–∂–¥–∏ 10-15 –º–∏–Ω—É—Ç

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –Ω—É–∂–Ω–æ –≤—Ä–µ–º—è –Ω–∞:

1. **DNS propagation** - —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ DNS (2-5 –º–∏–Ω—É—Ç)
2. **SSL certificate provisioning** - —Å–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ Google (5-15 –º–∏–Ω—É—Ç)

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å DNS (—á–µ—Ä–µ–∑ 2-5 –º–∏–Ω—É—Ç)

```bash
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: 34.128.141.177
dig order.dolinaflo.com +short
```

### 2. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (—á–µ—Ä–µ–∑ 10-15 –º–∏–Ω—É—Ç)

```bash
gcloud compute ssl-certificates describe order-ssl-cert --global
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
status: ACTIVE
type: MANAGED
```

–ï—Å–ª–∏ `status: PROVISIONING` - –ø–æ–¥–æ–∂–¥–∏ –µ—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.

### 3. –ü—Ä–æ–≤–µ—Ä—å —Å–∞–π—Ç (–ø–æ—Å–ª–µ ACTIVE —Å—Ç–∞—Ç—É—Å–∞)

```bash
curl -I https://order.dolinaflo.com
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:

```
HTTP/2 200
content-type: text/html
```

### 4. –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ

- https://order.dolinaflo.com
- https://order.dolinaflo.com/flowers
- https://order.dolinaflo.com/orders

–í—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: DNS –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
dig order.dolinaflo.com
```

**–†–µ—à–µ–Ω–∏–µ:**

- –£–±–µ–¥–∏—Å—å —á—Ç–æ A –∑–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ –≤ Cloudflare
- IP –∞–¥—Ä–µ—Å: `34.128.141.177`
- Proxy: OFF (—Å–µ—Ä–æ–µ –æ–±–ª–∞–∫–æ)
- –ü–æ–¥–æ–∂–¥–∏ 5 –º–∏–Ω—É—Ç –¥–ª—è propagation

### –ü—Ä–æ–±–ª–µ–º–∞: SSL certificate –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
gcloud compute ssl-certificates describe order-ssl-cert --global
```

**–ï—Å–ª–∏ status: FAILED_NOT_VISIBLE:**

- DNS –µ—â–µ –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏–ª—Å—è
- –ü–æ–¥–æ–∂–¥–∏ –µ—â–µ 5-10 –º–∏–Ω—É—Ç
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ DNS —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP

**–ï—Å–ª–∏ status: PROVISIONING –¥–æ–ª–≥–æ:**

- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 15-20 –º–∏–Ω—É—Ç
- Google –ø—Ä–æ–≤–µ—Ä—è–µ—Ç DNS –∏ —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: 404 –∏–ª–∏ 403

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª—ã –≤ bucket
gsutil ls -r gs://order.dolinaflo.com/

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –∑–∞–≥—Ä—É–∑–∏ –∑–∞–Ω–æ–≤–æ
cd /Users/maximviazov/Developer/Golang/GoLandWorkspace/dolina-flower-order-frontend
./upload-to-gcs.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ index.html, —Ä–æ—É—Ç—ã 404

**–ü—Ä–∏—á–∏–Ω–∞:** Backend bucket –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SPA routing –∏–∑ –∫–æ—Ä–æ–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ 1:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Hash Router (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è GCS)

–û–±–Ω–æ–≤–∏ `src/App.tsx`:

```typescript
import {HashRouter as Router} from 'react-router-dom';
// –í–º–µ—Å—Ç–æ BrowserRouter
```

**–†–µ—à–µ–Ω–∏–µ 2:** Cloud Functions –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ (—Å–ª–æ–∂–Ω–µ–µ)

**–†–µ—à–µ–Ω–∏–µ 3:** Firebase Hosting –≤–º–µ—Å—Ç–æ GCS (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç rewrites)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Load Balancer metrics

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
gcloud compute backend-buckets describe order-backend-bucket --global

# –õ–æ–≥–∏
gcloud logging read "resource.type=http_load_balancer" --limit 50
```

### SSL Certificate status

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
gcloud compute ssl-certificates describe order-ssl-cert --global

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
gcloud compute ssl-certificates list
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ:

```bash
# –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π
make deploy-gcs

# –ò–ª–∏ –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
./upload-to-gcs.sh
```

CDN –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.

–î–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞:

```bash
# –û—á–∏—Å—Ç–∫–∞ CDN –∫—ç—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—É—Ç–∏
gcloud compute url-maps invalidate-cdn-cache order-lb \
    --path "/*" \
    --async
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —Å Load Balancer

| –°–µ—Ä–≤–∏—Å          | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å        |
|-----------------|----------------------|
| Cloud Storage   | ~$1-2                |
| Cloud CDN       | ~$1-3                |
| Load Balancer   | ~$18 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) |
| SSL Certificate | $0 (managed)         |
| **–ò—Ç–æ–≥–æ**       | **~$20-23/–º–µ—Å**      |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Load Balancer –¥–æ—Ä–æ–∂–µ, –Ω–æ –¥–∞–µ—Ç:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π SSL –æ—Ç Google
- ‚úÖ Global CDN
- ‚úÖ DDoS –∑–∞—â–∏—Ç–∞
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üéØ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ Load Balancer —Å–æ–∑–¥–∞–Ω
- ‚úÖ Static IP –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω: `34.128.141.177`
- ‚úÖ Backend bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ CDN –≤–∫–ª—é—á–µ–Ω
- ‚úÖ SSL certificate –∑–∞–ø—Ä–æ—à–µ–Ω
- ‚úÖ HTTP ‚Üí HTTPS redirect –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- üîÑ –û–∂–∏–¥–∞–µ—Ç—Å—è: DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Cloudflare
- üîÑ –û–∂–∏–¥–∞–µ—Ç—Å—è: SSL certificate provisioning (10-15 –º–∏–Ω—É—Ç)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–µ–π—á–∞—Å**: –û–±–Ω–æ–≤–∏ DNS –≤ Cloudflare (A –∑–∞–ø–∏—Å—å, Proxy OFF)
2. **–ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç**: –ü—Ä–æ–≤–µ—Ä—å DNS —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è
3. **–ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç**: –ü—Ä–æ–≤–µ—Ä—å SSL –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è
4. **–ì–æ—Ç–æ–≤–æ**: –û—Ç–∫—Ä–æ–π https://order.dolinaflo.com –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

**–í–∞–∂–Ω–æ:** –ù–µ –≤–∫–ª—é—á–∞–π Cloudflare Proxy (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ), –∏—Å–ø–æ–ª—å–∑—É–π DNS only (—Å–µ—Ä–æ–µ –æ–±–ª–∞–∫–æ)!

